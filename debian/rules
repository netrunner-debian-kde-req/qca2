#!/usr/bin/make -f

include /usr/share/pkg-kde-tools/qt-kde-team/3/debian-qt-kde.mk
# Enable strict interdependencies
libpkgs_gen_strict_local_shlibs = $(libpkgs_all_packages)
include /usr/share/pkg-kde-tools/qt-kde-team/3/library-packages.mk

DEB_HOST_MULTIARCH ?= $(shell dpkg-architecture -qDEB_HOST_MULTIARCH)
QT5_BUILD_DIR = "obj-$(DEB_HOST_MULTIARCH)-qt5"
QT5_PACKAGES = $(shell grep Package: debian/control | grep qt5 | grep -v '\-dbg' | sed -e 's/Package: //g')
QT5_DH_EXCLUDE := $(foreach package, $(QT5_PACKAGES), -N $(package))
QT5_DH_INCLUDE := $(foreach package, $(QT5_PACKAGES), -p $(package))

override_dh_auto_clean:
	$(overridden_command)
	rm -rf $(QT5_BUILD_DIR)

override_dh_auto_configure:
	$(overridden_command)                                   -- -DLIB_SUFFIX="/$(DEB_HOST_MULTIARCH)"
	$(overridden_command) --builddirectory=$(QT5_BUILD_DIR) -- -DLIB_SUFFIX="/$(DEB_HOST_MULTIARCH)" -DQCA_SUFFIX="qt5"

override_dh_auto_build:
	$(overridden_command)
	$(overridden_command) --builddirectory=$(QT5_BUILD_DIR)

override_dh_auto_install:
	$(overridden_command)
	$(overridden_command) --builddirectory=$(QT5_BUILD_DIR) --destdir=debian/tmp-qt5

override_dh_install:
	$(overridden_command) $(QT5_DH_EXCLUDE)
	# Qt 5 needs to fail missing as it won't be covered in regular list-missing magic :'<
	$(overridden_command) $(QT5_DH_INCLUDE) --sourcedir=debian/tmp-qt5 --fail-missing

override_dh_strip:
	$(overridden_command) $(QT5_DH_EXCLUDE) --dbg-package=libqca2-dbg
	$(overridden_command) $(QT5_DH_INCLUDE) --dbg-package=libqca-qt5-2-dbg
